<div class="admin-container">
  <aside class="sidebar">
    <div class="sidebar-header">
      <i class="fas fa-shield-alt"></i>
      <h2>Admin Panel</h2>
    </div>
    <nav class="sidebar-nav">
      <button class="nav-item" [class.active]="activeTab === 'dashboard'" (click)="switchTab('dashboard')">
        <i class="fas fa-chart-line"></i><span>Dashboard</span>
      </button>
      <button class="nav-item" [class.active]="activeTab === 'events'" (click)="switchTab('events')">
        <i class="fas fa-calendar-alt"></i><span>Events</span>
      </button>
      <button class="nav-item" [class.active]="activeTab === 'users'" (click)="switchTab('users')">
        <i class="fas fa-users"></i><span>Users</span>
      </button>
    </nav>
    <button class="logout-btn" (click)="logout()">
      <i class="fas fa-sign-out-alt"></i><span>Logout</span>
    </button>
  </aside>
  <main class="main-content">
    <header class="content-header">
      <h1>{{ activeTab === 'dashboard' ? 'Dashboard' : activeTab === 'events' ? 'Event Management' : 'User Management' }}</h1>
    </header>
    <div *ngIf="successMessage" class="alert alert-success">
      <i class="fas fa-check-circle"></i> {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="alert alert-error">
      <i class="fas fa-exclamation-circle"></i> {{ errorMessage }}
    </div>
    <div *ngIf="activeTab === 'dashboard'" class="dashboard-content">
      <div class="stats-grid" *ngIf="statistics">
        <div class="stat-card">
          <div class="stat-icon events"><i class="fas fa-calendar"></i></div>
          <div class="stat-details">
            <h3>{{ statistics.totalEvents }}</h3>
            <p>Total Events</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon available"><i class="fas fa-check"></i></div>
          <div class="stat-details">
            <h3>{{ statistics.availableEvents }}</h3>
            <p>Available Events</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon users"><i class="fas fa-users"></i></div>
          <div class="stat-details">
            <h3>{{ statistics.totalUsers }}</h3>
            <p>Total Users</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon registrations"><i class="fas fa-user-check"></i></div>
          <div class="stat-details">
            <h3>{{ statistics.totalRegistrations }}</h3>
            <p>Total Registrations</p>
          </div>
        </div>
      </div>
      <div class="quick-stats">
        <div class="quick-stat-item">
          <span class="label">Admin Users:</span>
          <span class="value">{{ statistics?.adminUsers || 0 }}</span>
        </div>
        <div class="quick-stat-item">
          <span class="label">Student Users:</span>
          <span class="value">{{ statistics?.studentUsers || 0 }}</span>
        </div>
        <div class="quick-stat-item">
          <span class="label">Full Events:</span>
          <span class="value">{{ statistics?.fullEvents || 0 }}</span>
        </div>
      </div>
    </div>
    <div *ngIf="activeTab === 'events'" class="events-content">
      <div class="content-actions">
        <button class="btn btn-primary" (click)="openCreateEventModal()">
          <i class="fas fa-plus"></i> Create New Event
        </button>
      </div>
      <div class="table-container">
        <table class="data-table">
          <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Date</th>
            <th>Seats Left</th>
            <th>Status</th>
            <th>Registrations</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let event of events">
            <td>{{ event.id }}</td>
            <td>{{ event.title }}</td>
            <td>{{ event.date | date:'short' }}</td>
            <td>{{ event.seatsLeft }}</td>
            <td>
                <span class="badge" [class.available]="!event.isFull" [class.full]="event.isFull">
                  {{ event.isFull ? 'FULL' : 'AVAILABLE' }}
                </span>
            </td>
            <td>{{ event.users?.length || 0 }}</td>
            <td class="actions">
              <button class="btn-icon" (click)="openEditEventModal(event)" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-icon delete" (click)="deleteEvent(event)" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div *ngIf="activeTab === 'users'" class="users-content">
      <div class="table-container">
        <table class="data-table">
          <thead>
          <tr>
            <th>ID</th>
            <th>Email</th>
            <th>Username</th>
            <th>Role</th>
            <th>Events Registered</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let user of users">
            <td>{{ user.id }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.username || 'N/A' }}</td>
            <td>
                <span class="role-badge" [class.admin]="user.role === 'ROLE_ADMIN'" [class.student]="user.role === 'ROLE_STUDENT'">
                  {{ user.role }}
                </span>
            </td>
            <td>{{ user.events?.length || 0 }}</td>
            <td class="actions">
              <button class="btn-icon" (click)="viewUserDetails(user)" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-icon delete" (click)="deleteUser(user)" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>
<div class="modal-overlay" *ngIf="showEventModal" (click)="closeEventModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Edit Event' : 'Create New Event' }}</h2>
      <button class="close-btn" (click)="closeEventModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Title *</label>
        <input type="text" [(ngModel)]="eventForm.title" placeholder="Event title" required>
      </div>
      <div class="form-group">
        <label>Description *</label>
        <textarea [(ngModel)]="eventForm.description" rows="3" placeholder="Event description" required></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Date *</label>
          <input type="datetime-local" [(ngModel)]="eventForm.date" required>
        </div>
        <div class="form-group">
          <label>Seats *</label>
          <input type="number" [(ngModel)]="eventForm.seatsLeft" min="0" placeholder="Number of seats" required>
        </div>
      </div>
      <div class="form-group">
        <label>AI Image Prompt (Optional)</label>
        <textarea [(ngModel)]="eventForm.aiPrompt" rows="2" placeholder="e.g., A vibrant classroom with students coding"></textarea>
      </div>
      <div class="form-group">
        <label>Image URL</label>
        <input type="text" [(ngModel)]="eventForm.image" placeholder="https://example.com/image.jpg">
      </div>
      <div class="form-group">
        <button type="button" class="btn btn-info" (click)="generateAiImage()" [disabled]="isGeneratingImage">
          <i class="fas" [ngClass]="isGeneratingImage ? 'fa-spinner fa-spin' : 'fa-magic'"></i>
          {{ isGeneratingImage ? 'Generating...' : 'Generate AI Image' }}
        </button>
      </div>
      <div class="form-group" *ngIf="generatedImageUrl">
        <label>Generated Image Preview</label>
        <img [src]="generatedImageUrl" [alt]="'Preview for ' + eventForm.title" class="img-fluid preview-image">
        <p class="small text-muted">Generated URL: {{ generatedImageUrl }}</p>
      </div>
      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" [(ngModel)]="eventForm.isFull">
          <span>Mark as Full</span>
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEventModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveEvent()" [disabled]="isLoading">
        <i class="fas" [ngClass]="isLoading ? 'fa-spinner fa-spin' : 'fa-save'"></i>
        {{ isLoading ? 'Saving...' : 'Save' }}
      </button>
    </div>
  </div>
</div>
<div class="modal-overlay" *ngIf="selectedUser" (click)="closeUserDetails()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>User Details</h2>
      <button class="close-btn" (click)="closeUserDetails()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="user-info">
        <p><strong>ID:</strong> {{ selectedUser.id }}</p>
        <p><strong>Email:</strong> {{ selectedUser.email }}</p>
        <p><strong>Username:</strong> {{ selectedUser.username || 'N/A' }}</p>
        <p><strong>Role:</strong> {{ selectedUser.role }}</p>
        <p><strong>Events Registered:</strong> {{ selectedUser.events?.length || 0 }}</p>
      </div>
      <div class="user-actions">
        <h3>Change Role</h3>
        <button class="btn btn-secondary" (click)="changeUserRole(selectedUser, 'ROLE_ADMIN')" [disabled]="selectedUser.role === 'ROLE_ADMIN'">
          Make Admin
        </button>
        <button class="btn btn-secondary" (click)="changeUserRole(selectedUser, 'ROLE_STUDENT')" [disabled]="selectedUser.role === 'ROLE_STUDENT'">
          Make Student
        </button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeUserDetails()">Close</button>
    </div>
  </div>
</div>
